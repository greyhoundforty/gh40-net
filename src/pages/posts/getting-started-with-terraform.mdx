---
layout: "@/layouts/BlogPost"
title: "Getting Started with Terraform and the IBM Cloud"
publishDate: 05 January 2023
description: "In this introduction post you will learn about the core concepts and components of HashiCorp Terraform."
tags: ["ibmcloud", "terraform"]
draft: false
---

# What is Terraform?

[Terraform](https://www.terraform.io/) is an Infrastructure as Code (IaC) tool for managing infrastructure in a repeatable and consistent manner. Terraform allows you to define your infrastructure resources (Azure VMs, IBM Cloud VPCs, AWS Route 53 records, etc) in human-readable configuration files. Terraform will create, update, and destroy the resources as needed to meet your requirements.

## Why Use Terraform?

- Platform agnostic: Terraform can be used to manage infrastructure over a wide range of Cloud providers, on-prem hypervisors, SaSS providers, custom solutions, and more.  

- Declarative and Idempotent: A tool is considered *idempotent* if running apply operations multiple times does not change the result. 

- Automate changes: 

## Terraform Workflow

The core Terraform workflow consists of 4 main stages:

![](https://dsc.cloud/quickshare/tf-flow.png)

### 1. Write
Define the resources or services you want to create, update, or manage using the HashiCorp Configuration Language (HCL).

### 2. Initialize
Initializing a Terraform directory will automatically download the necessary plugins and modules to support the resources and services defined in your configuration.

### 3. Plan: 

Now that the directory is initialized and the provider plugins are installed, use the `terraform plan` command to create an execution plan that outlines the changes Terraform needs to make to meet the desired state. At a high level a `terraform plan` will:

- Look at the current state of deployed resources.
- Compare the current state of the deployed resources to the desired state defined in the configuration files.
- List the changes that will be made to meet the desired state. No changes to the resources is made until the plan is `applied`

### 4. Apply
Applying a Terraform plan will kick off the process to create, update, or destroy the resources as needed to meet your requirements.

## Terraform Components

Terraform consists of a number of components that work together to manage infrastructure. While we won't cover every piece of Terraform, we'll hit the main components that you will need to know to get started.

### Terraform Core
The core Terraform binary that is used to manage infrastructure. 

### Providers
Plugins that allow Terraform to interact with specific technologies. These are usually Cloud providers like IBM Cloud, AWS, Azure, etc. but can also be other technologies like Kubernetes, Docker, etc. 

```hcl
terraform {
  required_providers {
    ibm = {
      source = "IBM-Cloud/ibm"
      version = "1.49.0"
    }
  }
}
```
In the following example I have defined the IBM Cloud provider and set the version to `1.49.0`. This instructs Terraform core to download version `1.49.0` of the IBM Cloud provider plugin and use it to manage the resources defined in the configuration files. Terraform core uses a number of other components to manage and interact with infrastructure.

### Resources
Resources are the building blocks of Terraform. Resources are defined in your Terraform configuration files and represent the infrastructure you want to create, update, manage, etc. In the following example I have defined a new IBM Cloud Resource Group as well as a new SSH key pair.

```hcl
resource "ibm_resource_group" "group" {
  name  = "${var.project_prefix}-resource-group"
  tags  = var.tags
}

resource "tls_private_key" "ssh" {
  algorithm = "RSA"
  rsa_bits  = 4096
}
```

### Variables 

#### Primitive Types

- `string`: A sequence of characters
- `number`: A numeric value
- `bool`: A boolean value (true or false)

#### Complex Types

- `list`: A list of values
- `map`: A map of key/value pairs
- `object`: A set of values

### Data Sources

Data sources allow Terraform to use/read information defined outside of Terraform. This can be information about a Cloud provider, a local file, or another Terraform managed resource. While managed resources cause Terraform to create, update, and delete infrastructure objects, data resources cause Terraform only to read objects. 

```hcl
data "ibm_is_zones" "regional" {
  region = var.region
}

data "ibm_resource_group" "group" {
  count = var.existing_resource_group != "" ? 1 : 0
  name  = var.existing_resource_group
}
```

### State Files 

State files are the source of truth for your environment. Terraform uses the state file to determine the changes to make to your infrastructure so that it will match your configuration. 

## Tutorial

In this tutorial, you will initialize a Terraform project and learn some of the basic commands to deploy a Docker container using Terraform.


### Prerequisites

- [IBM Cloud API Key](https://docs.docker.com/get-docker/)
- [Terraform](https://learn.hashicorp.com/tutorials/terraform/install-cli) installed

### Download Example Github Repository 


```bash

```

Create the two configuration files you will need for this tutorial. The `providers.tf` file outlines the infrastruture provider that Terraform will use to create and manage resources.  The `main.tf` file 
outlines the configuration for the resources that Terraform will create using the declared Docker provider.

```bash
  touch providers.tf
  touch main.tf
```

### Configure Terraform Variables

### Initialize Terraform

With the configuration files defined, initialize Terraform by executing the `init` command. 

```bash
yadda yadda yadda
```

## Create Terraform Plan

Now that the directory is initialized and the provider plugins are installed, use the `plan` command to create an execution plan that outlines the changes Terraform needs to make to meet the desired 
state. At a high level a `terraform plan` will:

- Look at the current state of deployed resources 
- Compare the current state of the deployed resources to the desired state defined in the configuration files
- List the changes that will be made to meet the desired state

By default the `plan` command will output the plan to the terminal. You can also output the plan to a file by adding the `-out` flag and specifying a file name. This is useful if you want to run the `apply` command at a later time.

```bash
yadda yadda yadda 
yadda yadda yadda 
yadda yadda yadda 
```

## Apply Terraform Plan

To deploy the resources outlined in the previous `plan` step, run the `apply` command to provision the Docker container. Running the `apply` command without a saved plan file will generate a new plan and prompt you to accept the proposed changes. When you are run `terraform apply` on a saved plan you will not be prompted to accept the changes.


```bash
yadda yadda yadda 
yadda yadda yadda 
yadda yadda yadda 
```
```

## Make a Change and Generate a New Plan

As Terraform is all about current state vs desired state, you can update the current configuration and run `plan` to see the proposed changes

Open `main.tf` in your text editor, paste in this updated configuration, and save the file.

```hcl
yadda yadda yadda 
yadda yadda yadda 
yadda yadda yadda 
```

With the changes made run `terraform plan` and inspect the output. You should see that Terraform will destroy the existing container and create a new one based on the changes to the configuration.

```bash
yadda yadda yadda 
yadda yadda yadda 
yadda yadda yadda 
```

## Destroy Terraform Resources

To clean up the resources you can issue the `destroy` command. This will generate a plan for the resources to be deleted and then prompt you to accept the changes and destroy the resources. You can also use `plan -destroy` or `apply -destroy` to initiate a destruction plan for the resources.

```bash
yadda yadda yadda 
yadda yadda yadda 
yadda yadda yadda 
```

## Next steps

In this tutorial, you have learned how to:

- Create and initialize a Terraform configuration using HCL


Now that you have a basic understanding of Terraform, extend this example with the use of [Variables](https://www.terraform.io/language/values/variables#input-variables) or explore the [Terraform 
Registry](https://registry.terraform.io/) to find more Terraform providers and modules. 
